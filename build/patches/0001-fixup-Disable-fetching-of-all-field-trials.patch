From f6722f030c58102eb35af8a3a1cefb8f32226ced Mon Sep 17 00:00:00 2001
From: althafvly <althafvly@gmail.com>
Date: Wed, 20 Sep 2023 09:48:52 +0530
Subject: [PATCH 1/4] fixup Disable fetching of all field trials

---
 .../services/SafeModeVariationsSeedContentProvider.java   | 8 +-------
 build/android/gyp/proguard.py                             | 2 ++
 .../service/variations_field_trial_creator_base.cc        | 2 ++
 3 files changed, 5 insertions(+), 7 deletions(-)

diff --git a/android_webview/nonembedded/java/src/org/chromium/android_webview/services/SafeModeVariationsSeedContentProvider.java b/android_webview/nonembedded/java/src/org/chromium/android_webview/services/SafeModeVariationsSeedContentProvider.java
index 4a5bbb81a6812..c3fd6b3fbd68a 100644
--- a/android_webview/nonembedded/java/src/org/chromium/android_webview/services/SafeModeVariationsSeedContentProvider.java
+++ b/android_webview/nonembedded/java/src/org/chromium/android_webview/services/SafeModeVariationsSeedContentProvider.java
@@ -87,13 +87,7 @@ public class SafeModeVariationsSeedContentProvider extends ContentProvider {
     }
 
     private Boolean awaitSeedResults() {
-        CountDownLatch countDownLatch = new CountDownLatch(1);
-        try {
-            return countDownLatch.await(TIMEOUT_IN_MILLIS, TimeUnit.MILLISECONDS);
-        } catch (InterruptedException e) {
-            Log.w(TAG, e.toString());
-            return false;
-        }
+        return false;
     }
 
     @Override
diff --git a/build/android/gyp/proguard.py b/build/android/gyp/proguard.py
index 8ee6a884afd9b..ed8139dd90f4e 100755
--- a/build/android/gyp/proguard.py
+++ b/build/android/gyp/proguard.py
@@ -54,6 +54,8 @@ _IGNORE_WARNINGS = (
         r'PaymentRequest[BH]',
         # com.google.android.gms.cast is stripped down from the build
         r'class com\.google\.android\.gms\.',
+        # No fetching of trials
+        r'org\.chromium\.android_webview\.services\.AwVariationsSeedFetcher',
     ]) + ')',
     # TODO(agrieve): Remove once we update to U SDK.
     r'OnBackAnimationCallback',
diff --git a/components/variations/service/variations_field_trial_creator_base.cc b/components/variations/service/variations_field_trial_creator_base.cc
index bdfbaccfc0e70..2f44107f0110d 100644
--- a/components/variations/service/variations_field_trial_creator_base.cc
+++ b/components/variations/service/variations_field_trial_creator_base.cc
@@ -331,6 +331,8 @@ bool VariationsFieldTrialCreatorBase::SetUpFieldTrials(
                              safe_seed_manager, synthetic_trial_registry);
   }
 
+  platform_field_trials->RegisterFeatureOverrides(feature_list.get());
+
   base::FeatureList::SetInstance(std::move(feature_list));
 
   // For testing Variations Safe Mode, maybe crash here.
-- 
2.34.1

